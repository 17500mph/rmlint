## This is the makefile for mpdbox 
## Just type 'make -j 4'
## Targets: 'mpdbox','clean'
##

#source dir
SOURCEDIR=src

#MANDIR
MANDIR=/usr/share/man/man1

#colors
NO_COLOR=\x1b[0m
OK_COLOR=\x1b[32;01m
ERROR_COLOR=\x1b[31;01m
WARN_COLOR=\x1b[33;01m

#install
INSTALLPATH=/usr/bin

#Programs 
ECHO=printf 
RM=rm -rf
CAT=cat
CP=cp

#compiling stuff
CC=gcc
 
WARN=-ansi -Wall -pedantic 
OPTI= -march=native -s -Os -finline-functions  -fno-builtin-malloc -fno-builtin-calloc -fno-builtin-realloc -fno-builtin-free
CFLAGS=-c -pipe $(OPTI) $(WARN)

LDFLAGS=-lpthread -L tcmalloc/libtcmalloc_minimal.a

SOURCES= \
	$(SOURCEDIR)/md5.c \
	$(SOURCEDIR)/mt.c \
	$(SOURCEDIR)/filter.c \
	$(SOURCEDIR)/mode.c \
	$(SOURCEDIR)/list.c \
	$(SOURCEDIR)/rmlint.c \
	$(SOURCEDIR)/main.c


OBJECTS=$(SOURCES:.c=.o)
INCLUDE=
EXECUTABLE=rmlint 

all: $(SOURCES) $(EXECUTABLE)

$(EXECUTABLE):  $(OBJECTS)
	     @$(CC) $(LDFLAGS) $(OBJECTS) -o $@
	     @$(ECHO) "$(WARN_COLOR)=> Linking program done.\n" $(NO_COLOR) 

.c.o: 	
	@$(ECHO) "$(OK_COLOR)-> Compiling $<\n"
	@$(ECHO) "$(ERROR_COLOR)"
	@$(CC) $(INCLUDE) $(LDFLAGS)  $(CFLAGS) $< -o $@
	@$(ECHO) "$(NO_COLOR)" 

clean:
	@$(ECHO) "$(OK_COLOR)<> Making clean.\n"
	@$(RM) $(SOURCEDIR)/*.o $(EXECUTABLE) 2> /dev/null
	@$(ECHO) "$(NO_COLOR)"

install: 
	$(CP) $(EXECUTABLE) $(INSTALLPATH)
	$(CP) doc/rmlint.1.gz $(MANDIR)
